<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×‘×“×ª ×—×§×™×¨×” ×•×©××œ×•×Ÿ ××™× ×˜×¨××§×˜×™×‘×™</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js (Stable UMD Version) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Font (Heebo) -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Heebo', sans-serif; background-color: #f8fafc; color: #1e293b; }
        
        /* Graph Containers */
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
            margin-bottom: 20px;
            background-color: #ffffff;
        }

        .tab-active { 
            border-bottom: 2px solid #2563eb; 
            color: #1e40af; 
            font-weight: 700; 
            background-color: #eff6ff;
        }

        .math-serif { font-family: 'Times New Roman', serif; font-style: italic; }
        .math-ltr { direction: ltr; display: inline-block; unicode-bidi: embed; }

        .btn-func { transition: all 0.2s; border-width: 2px; }
        .btn-func:hover { transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .btn-func.active { ring: 2px; ring-offset: 2px; }

        /* Custom Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px; width: 18px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -7px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer; background: #cbd5e1;
            border-radius: 2px;
        }
        #sliderA::-webkit-slider-thumb { background: #16a34a; }
        #sliderB::-webkit-slider-thumb { background: #dc2626; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white w-8 h-8 flex items-center justify-center rounded-lg font-bold text-lg">âˆ«</div>
                <h1 class="text-lg md:text-xl font-bold text-gray-800">××¢×‘×“×ª ×—×§×™×¨×”: ×”×¦×˜×‘×¨×•×ª ×•×¡×™××˜×¨×™×”</h1>
            </div>
            <nav class="flex gap-2 bg-gray-100 p-1 rounded-lg">
                <button onclick="switchTab('visuals')" id="btn-visuals" class="tab-active px-4 py-1.5 text-sm rounded-md transition-all">××¢×‘×“×”</button>
                <button onclick="switchTab('quiz')" id="btn-quiz" class="px-4 py-1.5 text-sm text-gray-500 rounded-md hover:bg-white hover:shadow-sm transition-all">×©××œ×•×Ÿ</button>
            </nav>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 py-6 w-full">

        <!-- SECTION 1: VISUAL LAB -->
        <div id="section-visuals" class="fade-in">
            
            <div class="flex flex-col lg:flex-row gap-6">
                
                <!-- Controls Column -->
                <div class="w-full lg:w-1/3 space-y-6 lg:order-last">
                    
                    <!-- Function Selection -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">1. ×‘×—×™×¨×ª ×¤×•× ×§×¦×™×”</h3>
                        <div class="space-y-3">
                            <button onclick="setFunction('even')" id="btn-even" class="btn-func w-full py-3 px-4 rounded-lg border-blue-200 bg-blue-50 text-blue-900 text-right flex justify-between items-center active ring-blue-500">
                                <span class="font-bold">×¤×•× ×§×¦×™×” ×–×•×’×™×ª</span>
                                <span class="math-serif math-ltr font-bold text-blue-600 text-sm">x<sup>2</sup> - 2</span>
                            </button>
                            
                            <button onclick="setFunction('odd')" id="btn-odd" class="btn-func w-full py-3 px-4 rounded-lg border-orange-200 bg-orange-50 text-orange-900 text-right flex justify-between items-center">
                                <span class="font-bold">×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª</span>
                                <span class="math-serif math-ltr font-bold text-orange-600 text-sm">x<sup>3</sup> - 3x</span>
                            </button>

                            <button onclick="setFunction('neither')" id="btn-neither" class="btn-func w-full py-3 px-4 rounded-lg border-gray-300 bg-gray-50 text-gray-800 text-right flex justify-between items-center">
                                <span class="font-bold">×›×œ×œ×™×ª (×œ×œ× ×¡×™××˜×¨×™×”)</span>
                                <span class="math-serif math-ltr font-bold text-gray-600 text-sm">0.5(x-1)<sup>2</sup> - 1</span>
                            </button>
                        </div>
                    </div>

                    <!-- Integration Limits -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">2. ×’×‘×•×œ×•×ª ×”××™× ×˜×’×¨×¦×™×”</h3>
                        
                        <div class="mb-4">
                            <label class="flex justify-between text-sm font-medium mb-1">
                                <span class="text-green-700 font-bold">×’×‘×•×œ ×ª×—×ª×•×Ÿ (a)</span>
                                <span class="font-mono bg-green-50 px-2 rounded text-green-700 text-xs" id="valA">-2.0</span>
                            </label>
                            <input type="range" id="sliderA" min="-3.5" max="3.5" step="0.1" value="-2.0" class="w-full">
                        </div>

                        <div class="mb-6">
                            <label class="flex justify-between text-sm font-medium mb-1">
                                <span class="text-red-700 font-bold">×’×‘×•×œ ×¢×œ×™×•×Ÿ (b)</span>
                                <span class="font-mono bg-red-50 px-2 rounded text-red-700 text-xs" id="valB">2.0</span>
                            </label>
                            <input type="range" id="sliderB" min="-3.5" max="3.5" step="0.1" value="2.0" class="w-full">
                        </div>

                        <!-- Result Box: LTR forced for numbers -->
                        <div class="p-4 bg-slate-50 rounded-lg border border-slate-200 text-center">
                            <span class="block text-xs text-slate-500 mb-1 font-bold">×”×¢×¨×š ×”××¦×˜×‘×¨ ×‘×™×Ÿ a ×œ-b</span>
                            <div class="flex items-baseline justify-center gap-2" dir="ltr">
                                <span class="math-serif text-lg text-gray-400">âˆ«<sub>a</sub><sup>b</sup> f(x) dx = </span>
                                <span id="integralResult" class="text-3xl font-mono font-bold text-gray-800 transition-colors">0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Graphs Column -->
                <div class="w-full lg:w-2/3 lg:order-first flex flex-col gap-4">
                    
                    <!-- Graph 1 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-2 relative">
                        <div class="absolute top-2 right-4 bg-white/90 px-2 py-1 rounded text-xs font-bold text-gray-600 border border-gray-100 z-10 shadow-sm">
                            1. ×”×¤×•× ×§×¦×™×”: <span class="math-ltr">f(x)</span>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="chartF"></canvas>
                        </div>
                    </div>

                    <!-- Graph 2 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-2 relative">
                        <div class="absolute top-2 right-4 bg-white/90 px-2 py-1 rounded text-xs font-bold text-purple-600 border border-purple-100 z-10 shadow-sm">
                            2. ×¤×•× ×§×¦×™×™×ª ×”×”×¦×˜×‘×¨×•×ª: <span class="math-ltr">g(x) = âˆ«<sub>a</sub><sup>x</sup> f(t)dt</span>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="chartG"></canvas>
                        </div>
                        <p class="text-center text-xs text-gray-400 mt-1">
                            ×©×™××• ×œ×‘: <span class="math-ltr">g(x)</span> ×¢×•×œ×” ×›×©-<span class="math-ltr">f(x)</span> ×—×™×•×‘×™×ª, ×•×™×•×¨×“×ª ×›×©-<span class="math-ltr">f(x)</span> ×©×œ×™×œ×™×ª. ×ª××™×“ ××ª×§×™×™× <span class="math-ltr">g(a)=0</span>.
                        </p>
                    </div>

                </div>

            </div>
        </div>

        <!-- SECTION 2: QUIZ -->
        <div id="section-quiz" class="hidden max-w-3xl mx-auto">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">×©××œ×•×Ÿ ×ª×¨×’×•×œ</h2>
                    <span class="text-sm bg-blue-50 text-blue-700 px-3 py-1 rounded-full font-medium" id="qCountBadge">×©××œ×” 1 ××ª×•×š 10</span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-1.5 mb-8">
                    <div id="quizBar" class="bg-blue-600 h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <div id="questionBox" class="min-h-[250px]"></div>
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-100">
                    <button id="btnPrev" onclick="moveQ(-1)" disabled class="flex items-center gap-2 px-4 py-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition disabled:opacity-30"><span>â†’</span> ×”×§×•×“×</button>
                    <button id="btnNext" onclick="moveQ(1)" class="flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-sm transition hover:shadow-md">×”×‘× <span>â†</span></button>
                </div>
            </div>
            <div id="resultBox" class="hidden bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center max-w-2xl mx-auto mt-10">
                <div class="inline-block p-4 rounded-full bg-yellow-50 text-5xl mb-6">ğŸ†</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">×›×œ ×”×›×‘×•×“! ×¡×™×™××ª ××ª ×”×©××œ×•×Ÿ</h3>
                <p class="text-gray-500 mb-8">×¦×™×•×Ÿ ×¡×•×¤×™</p>
                <div class="text-6xl font-black text-blue-600 mb-2 tracking-tight" id="finalScore">0</div>
                <button onclick="initQuiz()" class="px-8 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition shadow-lg hover:shadow-xl">×”×ª×—×œ ××—×“×©</button>
            </div>
        </div>

    </main>

    <script>
        // --- VISUAL LAB LOGIC ---
        const labState = {
            funcType: 'even', 
            a: -2.0,
            b: 2.0,
            chartF: null,
            chartG: null
        };

        const funcs = {
            even: {
                label: 'xÂ² - 2',
                fn: x => x*x - 2,
                color: 'rgba(59, 130, 246, 0.4)', 
                borderColor: '#2563eb',
                yMin: -3, yMax: 5
            },
            odd: {
                label: 'xÂ³ - 3x',
                fn: x => Math.pow(x, 3) - 3*x,
                color: 'rgba(249, 115, 22, 0.4)', 
                borderColor: '#ea580c',
                yMin: -4, yMax: 4
            },
            neither: {
                label: '0.5(x-1)Â² - 1',
                fn: x => 0.5 * Math.pow(x-1, 2) - 1,
                color: 'rgba(75, 85, 99, 0.4)', 
                borderColor: '#374151',
                yMin: -2, yMax: 4
            }
        };

        function setFunction(type) {
            labState.funcType = type;
            ['even', 'odd', 'neither'].forEach(t => {
                const btn = document.getElementById(`btn-${t}`);
                if (t === type) {
                    btn.classList.add('ring-2', 'ring-offset-1', 'bg-slate-100');
                    btn.classList.remove('bg-white');
                } else {
                    btn.classList.remove('ring-2', 'ring-offset-1', 'bg-slate-100');
                    btn.classList.add('bg-white');
                }
            });
            updateLab();
        }

        function initCharts() {
            // Wait for Chart to be available
            if (typeof Chart === 'undefined') {
                console.error("Chart.js not loaded");
                return;
            }

            const ctxF = document.getElementById('chartF');
            const ctxG = document.getElementById('chartG');

            if (!ctxF || !ctxG) return;

            const gridColor = (ctx) => (ctx.tick.value === 0) ? '#334155' : '#e2e8f0';
            const lineWidth = (ctx) => (ctx.tick.value === 0) ? 2 : 1;

            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                scales: {
                    x: { 
                        type: 'linear', min: -3.5, max: 3.5, 
                        grid: { color: gridColor, lineWidth: lineWidth }
                    },
                    y: { 
                        grid: { color: gridColor, lineWidth: lineWidth }
                    }
                },
                plugins: { legend: { display: false } }
            };

            labState.chartF = new Chart(ctxF, {
                type: 'line',
                data: { datasets: [{ label: 'f(x)', data: [], borderWidth: 3, pointRadius: 0, fill: true, tension: 0.3 }] },
                options: { ...commonOptions }
            });

            labState.chartG = new Chart(ctxG, {
                type: 'line',
                data: { datasets: [{ 
                    label: 'g(x)', 
                    data: [], 
                    borderWidth: 3, 
                    borderColor: '#9333ea', 
                    backgroundColor: 'rgba(147, 51, 234, 0.1)',
                    pointRadius: 0, 
                    fill: false, 
                    tension: 0.3 
                }]},
                options: {
                    ...commonOptions,
                    scales: { ...commonOptions.scales, y: { ...commonOptions.scales.y, min: -5, max: 5 } }
                }
            });

            // Init Sliders
            document.getElementById('sliderA').addEventListener('input', (e) => {
                labState.a = parseFloat(e.target.value);
                updateLab();
            });
            document.getElementById('sliderB').addEventListener('input', (e) => {
                labState.b = parseFloat(e.target.value);
                updateLab();
            });

            setFunction('even');
        }

        function updateLab() {
            if (!labState.chartF || !labState.chartG) return;

            const fConfig = funcs[labState.funcType];
            const rawA = labState.a; 
            const rawB = labState.b;

            document.getElementById('valA').innerText = rawA.toFixed(1);
            document.getElementById('valB').innerText = rawB.toFixed(1);

            const pointsF = [];
            const pointsG = [];
            const startX = -3.5;
            const step = 0.05;
            const stepsCount = 140; // (3.5 - (-3.5)) / 0.05

            let baseIntegral = 0;
            const baseValues = []; 

            // Calculate Base Values (Integration from startX)
            for (let i = 0; i <= stepsCount; i++) {
                const x = startX + i * step;
                const y = fConfig.fn(x);
                pointsF.push({x, y});
                
                if (i > 0) {
                    const prevY = fConfig.fn(x - step);
                    baseIntegral += (y + prevY) * step / 2;
                }
                baseValues.push({x, val: baseIntegral});
            }

            // Offset g(x) so g(a) = 0
            // Find index closest to rawA
            const indexA = Math.max(0, Math.min(stepsCount, Math.round((rawA - startX) / step)));
            const offsetVal = baseValues[indexA].val;

            baseValues.forEach(p => {
                pointsG.push({ x: p.x, y: p.val - offsetVal });
            });

            // Update Chart F
            labState.chartF.options.scales.y.min = fConfig.yMin;
            labState.chartF.options.scales.y.max = fConfig.yMax;
            labState.chartF.data.datasets[0].data = pointsF;
            labState.chartF.data.datasets[0].borderColor = fConfig.borderColor;
            
            // Color Logic for F
            const lower = Math.min(rawA, rawB);
            const upper = Math.max(rawA, rawB);
            
            labState.chartF.data.datasets[0].segment = {
                backgroundColor: (ctx) => {
                    const x = ctx.p0.parsed.x;
                    const y = ctx.p0.parsed.y;
                    if (x >= lower && x <= upper) {
                        return y >= 0 ? 'rgba(59, 130, 246, 0.5)' : 'rgba(239, 68, 68, 0.4)';
                    }
                    return 'rgba(0,0,0,0)';
                }
            };

            // Update Chart G
            labState.chartG.data.datasets[0].data = pointsG;
            
            labState.chartF.update();
            labState.chartG.update();

            // Result
            const indexB = Math.max(0, Math.min(stepsCount, Math.round((rawB - startX) / step)));
            const valAtB = baseValues[indexB].val;
            const finalResult = valAtB - offsetVal;

            const resEl = document.getElementById('integralResult');
            resEl.textContent = finalResult.toFixed(2);
            
            if (finalResult > 0.05) resEl.className = "text-3xl font-mono font-bold text-blue-600 transition-colors";
            else if (finalResult < -0.05) resEl.className = "text-3xl font-mono font-bold text-red-500 transition-colors";
            else resEl.className = "text-3xl font-mono font-bold text-green-600 transition-colors";
        }

        // --- QUIZ DATA ---
        const quizData = [
            {
                q: "× ×ª×•× ×” ×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª <span class='math-serif math-ltr'>f(x)</span> ×”××§×™×™××ª <span class='math-serif math-ltr'>f(-x) = -f(x)</span>. ×× × ×ª×•×Ÿ ×©- <span class='math-serif math-ltr'>f'(2) = 5</span>, ××”×• ×¢×¨×š <span class='math-serif math-ltr'>f'(-2)</span>?",
                opts: ["-5", "5", "0", "×œ× × ×™×ª×Ÿ ×œ×“×¢×ª"],
                ans: 1, 
                rationale: "×”× ×’×–×¨×ª ×©×œ ×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª ×”×™× ×¤×•× ×§×¦×™×” ×–×•×’×™×ª, ×œ×›×Ÿ <span class='math-ltr'>f'(-x) = f'(x)</span>."
            },
            {
                q: "× ×ª×•× ×” ×¤×•× ×§×¦×™×” ×–×•×’×™×ª <span class='math-serif math-ltr'>g(x)</span>. ×× ×™×“×•×¢ ×©- <span class='math-serif math-ltr'>g'(3) = -4</span>, ××”×• ×¢×¨×›×• ×©×œ <span class='math-serif math-ltr'>g'(-3)</span>?",
                opts: ["-4", "4", "0", "×œ× × ×™×ª×Ÿ ×œ×“×¢×ª"],
                ans: 1,
                rationale: "×”× ×’×–×¨×ª ×©×œ ×¤×•× ×§×¦×™×” ×–×•×’×™×ª ×”×™× ××™-×–×•×’×™×ª, ×œ×›×Ÿ ×”×¡×™××Ÿ ××ª×”×¤×š."
            },
            {
                q: "×”× ×’×–×¨×ª ×©×œ ×¤×•× ×§×¦×™×” ×–×•×’×™×ª <span class='math-serif math-ltr'>g(x)</span> ×”×™× ×‘×”×›×¨×—:",
                opts: ["×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª", "×¤×•× ×§×¦×™×” ×–×•×’×™×ª", "×–×•×’×™×ª ××• ××™-×–×•×’×™×ª", "××£ ×ª×©×•×‘×”"],
                ans: 0,
                rationale: "×©×™×¤×•×¢ ×”××©×™×§ ××©×ª×§×£ ×‘××•×¤×Ÿ ×”×¤×•×š (×¢×œ×™×” ×”×•×¤×›×ª ×œ×™×¨×™×“×” ×‘×¦×“ ×”×©× ×™)."
            },
            {
                q: "×¢×‘×•×¨ ×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª <span class='math-serif math-ltr'>f(x)</span>, ××”×• ×¢×¨×š ×”××™× ×˜×’×¨×œ <span class='math-serif math-ltr text-lg'>âˆ«<sub>-a</sub><sup>a</sup> f(x) dx</span>?",
                opts: ["0", "<span class='math-ltr'>2 Â· âˆ«<sub>0</sub><sup>a</sup> f(x) dx</span>", "<span class='math-ltr'>-âˆ«<sub>0</sub><sup>a</sup> f(x) dx</span>", "×ª×œ×•×™ ×‘-a"],
                ans: 0,
                rationale: "×”×©×˜×—×™× ×”×—×™×•×‘×™×™× ×•×”×©×œ×™×œ×™×™× ××‘×˜×œ×™× ×–×” ××ª ×–×” ×‘×ª×—×•× ×¡×™××˜×¨×™."
            },
            {
                q: "× ×ª×•× ×” <span class='math-serif math-ltr'>f(x)</span> ××™-×–×•×’×™×ª. × ×ª×•×Ÿ <span class='math-serif math-ltr'>âˆ«<sub>0</sub><sup>3</sup> f(x) dx = 4</span>. ×—×©×‘×• ××ª <span class='math-serif math-ltr text-lg font-bold'>âˆ«<sub>-3</sub><sup>3</sup> (f(x) + 2) dx</span>.",
                opts: ["0", "8", "12", "16"],
                ans: 2,
                rationale: "×”××™× ×˜×’×¨×œ ××¤×•×¦×œ ×œ-2 ×—×œ×§×™×: <span class='math-ltr'>âˆ«f(x)</span> ×©××ª××¤×¡, ×•×©×˜×— ×”××œ×‘×Ÿ <span class='math-ltr'>âˆ«2 dx</span> ×©×”×•× <span class='math-ltr'>2 Â· [3 - (-3)] = 12</span>."
            },
            {
                q: "×¢×‘×•×¨ ×¤×•× ×§×¦×™×” ×–×•×’×™×ª <span class='math-serif math-ltr'>g(x)</span>, ××™×–×• ×˜×¢× ×” × ×›×•× ×”?",
                opts: [
                    "<span class='math-ltr'>âˆ«<sub>-a</sub><sup>a</sup> g(x) dx = 0</span>", 
                    "<span class='math-ltr'>âˆ«<sub>-a</sub><sup>a</sup> g(x) dx = 2âˆ«<sub>0</sub><sup>a</sup> g(x) dx</span>", 
                    "<span class='math-ltr'>âˆ«<sub>-a</sub><sup>a</sup> g(x) dx = âˆ«<sub>0</sub><sup>2a</sup> g(x) dx</span>", 
                    "××£ ×ª×©×•×‘×”"
                ],
                ans: 1,
                rationale: "×‘×¤×•× ×§×¦×™×” ×–×•×’×™×ª, ×”×©×˜×— ××©×××œ ×œ×¦×™×¨ ×©×•×•×” ×œ×©×˜×— ××™××™×Ÿ ×œ×¦×™×¨, ×œ×›×Ÿ ×¡×•×›××™× ××•×ª×."
            },
            {
                q: "×ª×”×™ <span class='math-serif math-ltr'>f(x)</span> ×¤×•× ×§×¦×™×” ×¨×¦×™×¤×” ×•××™-×–×•×’×™×ª ×”××•×’×“×¨×ª ×œ×›×œ <span class='math-ltr'>x</span>. × ×’×“×™×¨ ××ª ×”×¤×•× ×§×¦×™×” <span class='math-serif math-ltr'>g(x) = âˆ«<sub>-x</sub><sup>x</sup> f(t) dt</span>. ××™×–×• ××”×˜×¢× ×•×ª ×”×‘××•×ª ××ª××¨×ª × ×›×•×Ÿ ××ª <span class='math-ltr'>g(x)</span>?",
                opts: ["×”×™× ×”×¤×•× ×§×¦×™×” ×”×§×‘×•×¢×” y=0", "×”×™× ×¤×•× ×§×¦×™×” ×¢×•×œ×” ×œ×›×œ x", "×”×™× ×¤×•× ×§×¦×™×” ×–×•×’×™×ª ×©××™× ×” ×§×‘×•×¢×”", "×”×™× ×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª ×©××™× ×” ×§×‘×•×¢×”"],
                ans: 0,
                rationale: "× ×›×•×Ÿ! ×¢×‘×•×¨ ×›×œ ×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª, ×”××™× ×˜×’×¨×œ ×‘×’×‘×•×œ×•×ª ×¡×™××˜×¨×™×™× [-x, x] ×”×•× ×ª××™×“ ××¤×¡."
            },
            {
                q: "×ª×”×™ <span class='math-serif math-ltr'>f(x)</span> ×¤×•× ×§×¦×™×” ×¨×¦×™×¤×” ×•×–×•×’×™×ª. × ×’×“×™×¨ ×¤×•× ×§×¦×™×™×ª ×”×¦×˜×‘×¨×•×ª <span class='math-serif math-ltr'>g(x) = âˆ«<sub>a</sub><sup>x</sup> f(t) dt</span>. ××” ×—×™×™×‘ ×œ×”×™×•×ª ×”×¢×¨×š ×©×œ ×”×’×‘×•×œ ×”×ª×—×ª×•×Ÿ <span class='math-ltr'>a</span> ×›×“×™ ×©-<span class='math-ltr'>g(x)</span> ×ª×”×™×” ×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª?",
                opts: ["a=0", "a ×™×›×•×œ ×œ×”×™×•×ª ×›×œ ××¡×¤×¨ ×××©×™", "a ×—×™×™×‘ ×œ×”×™×•×ª ××¡×¤×¨ ×—×™×•×‘×™", "××£ ×¢×¨×š ×©×œ a ×œ× ×™×‘×˜×™×— ×–××ª"],
                ans: 0,
                rationale: "× ×›×•×Ÿ! ×¤×•× ×§×¦×™×” ××™-×–×•×’×™×ª ×—×™×™×‘×ª ×œ×¢×‘×•×¨ ×‘×¨××©×™×ª ×”×¦×™×¨×™× (g(0)=0), ×•×–×” ××ª×§×™×™× ×¨×§ ×× ×”××™× ×˜×’×¨×œ ××ª×—×™×œ ×‘-0."
            },
            {
                q: "× ×ª×•× ×” <span class='math-serif math-ltr'>h(x)</span> ×–×•×’×™×ª. × ×’×“×™×¨ <span class='math-serif math-ltr'>S(x) = âˆ«<sub>0</sub><sup>x</sup> h(t) dt</span>. ××™×–×• ×˜×¢× ×” × ×›×•× ×”?",
                opts: ["S(x) ×–×•×’×™×ª", "S(x) ××™-×–×•×’×™×ª", "S(x) ×§×‘×•×¢×”", "×œ× × ×™×ª×Ÿ ×œ×“×¢×ª"],
                ans: 1,
                rationale: "×¤×•× ×§×¦×™×” ×§×“×•××” ×œ×¤×•× ×§×¦×™×” ×–×•×’×™×ª (×©×¢×•×‘×¨×ª ×‘×¨××©×™×ª) ×”×™× ××™-×–×•×’×™×ª."
            },
            {
                q: "×”×× ×”××™× ×˜×’×¨×œ ×”×‘×œ×ª×™-××¡×•×™× ×©×œ ×¤×•× ×§×¦×™×” ×–×•×’×™×ª ×”×•× ×ª××™×“ ××™-×–×•×’×™?",
                opts: ["×ª××™×“", "××£ ×¤×¢×", "×¨×§ ×× ×”×§×‘×•×¢ C=0", "×¨×§ ×‘×¤×•×œ×™× ×•××™×"],
                ans: 2,
                rationale: "×§×‘×•×¢ ××™× ×˜×’×¨×¦×™×” <span class='math-ltr'>C â‰  0</span> ××–×™×– ××ª ×”×¤×•× ×§×¦×™×” ×× ×›×™×ª ×•×”×•×¨×¡×ª ××ª ×”×¡×™××˜×¨×™×” ×œ×¨××©×™×ª."
            }
        ];

        let qIdx = 0;
        let score = 0;
        let userAnswers = new Array(quizData.length).fill(null);

        function initQuiz() {
            qIdx = 0;
            score = 0;
            userAnswers.fill(null);
            document.getElementById('questionBox').style.display = 'block';
            document.getElementById('resultBox').classList.add('hidden');
            renderQ();
        }

        function renderQ() {
            const q = quizData[qIdx];
            const hasAns = userAnswers[qIdx] !== null;
            document.getElementById('qCountBadge').innerText = `×©××œ×” ${qIdx + 1} ××ª×•×š ${quizData.length}`;
            
            let html = `
                <div class="fade-in">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-6 leading-relaxed">${qIdx + 1}. ${q.q}</h3>
                    <div class="grid grid-cols-1 gap-3">
            `;

            q.opts.forEach((opt, i) => {
                let cls = "w-full text-right p-4 rounded-lg border border-gray-200 hover:bg-slate-50 transition relative overflow-hidden ";
                let explanation = "";
                let mark = "";
                
                if (hasAns) {
                    if (i === q.ans) {
                        cls = "w-full text-right p-4 rounded-lg border-2 border-green-500 bg-green-50 text-green-900 font-medium shadow-sm";
                        explanation = `<div class="mt-2 text-sm text-green-700 bg-white/50 p-2 rounded">${q.rationale}</div>`;
                        mark = "<span class='absolute left-4 top-4 text-green-600 text-xl'>âœ”</span>";
                    } else if (i === userAnswers[qIdx]) {
                        cls = "w-full text-right p-4 rounded-lg border-2 border-red-400 bg-red-50 text-red-900";
                        mark = "<span class='absolute left-4 top-4 text-red-500 text-xl'>âœ˜</span>";
                    } else {
                        cls = "w-full text-right p-4 rounded-lg border border-gray-100 opacity-40 grayscale";
                    }
                }

                html += `<button ${hasAns ? 'disabled' : ''} onclick="answer(${i})" class="${cls}">${opt} ${mark} ${explanation}</button>`;
            });

            html += `</div></div>`;
            document.getElementById('questionBox').innerHTML = html;

            document.getElementById('btnPrev').disabled = qIdx === 0;
            document.getElementById('btnNext').innerHTML = (qIdx === quizData.length - 1) ? `×¡×™×™× <span class="font-sans font-bold">âœ“</span>` : `×”×‘× <span class="font-sans font-bold">â†</span>`;
            
            const pct = ((qIdx + (hasAns?1:0)) / quizData.length) * 100;
            document.getElementById('quizBar').style.width = `${pct}%`;
        }

        function answer(i) {
            userAnswers[qIdx] = i;
            if (i === quizData[qIdx].ans) score++;
            renderQ();
        }

        function moveQ(dir) {
            if (dir === 1 && qIdx === quizData.length - 1) {
                endQuiz();
                return;
            }
            qIdx += dir;
            renderQ();
        }

        function endQuiz() {
            document.getElementById('questionBox').innerHTML = '';
            document.getElementById('resultBox').classList.remove('hidden');
            document.getElementById('finalScore').innerText = `${score * 10}`;
        }

        function switchTab(id) {
            document.getElementById('section-visuals').classList.toggle('hidden', id !== 'visuals');
            document.getElementById('section-quiz').classList.toggle('hidden', id !== 'quiz');
            
            const btnVisuals = document.getElementById('btn-visuals');
            const btnQuiz = document.getElementById('btn-quiz');
            
            if (id === 'visuals') {
                btnVisuals.className = 'tab-active px-4 py-1.5 text-sm rounded-md transition-all shadow-sm';
                btnQuiz.className = 'px-4 py-1.5 text-sm text-gray-500 rounded-md hover:bg-white transition-all';
            } else {
                btnQuiz.className = 'tab-active px-4 py-1.5 text-sm rounded-md transition-all shadow-sm';
                btnVisuals.className = 'px-4 py-1.5 text-sm text-gray-500 rounded-md hover:bg-white transition-all';
                if (userAnswers[0] === null) initQuiz();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
        });

    </script>
</body>
</html>